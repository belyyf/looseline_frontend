---
order: 3
title: –ú–æ–¥—É–ª—å —Å—Ç–∞–≤–æ–∫ –∏ —Ä–∞—Å—á—ë—Ç–æ–≤
---

**Backend –º–æ–¥—É–ª—å** –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫ –∏ —Ä–∞—Å—á—ë—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

-  event_id (–∫–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ)

-  odds_id (–∫–∞–∫–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

-  bet_amount (—Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏)

-  user_id (–∫—Ç–æ —Å—Ç–∞–≤–∏—Ç)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

-  –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏

-  –ö—É–ø–æ–Ω —Å –¥–µ—Ç–∞–ª—è–º–∏

-  –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à

-  –°—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏ (–æ—Ç–∫—Ä—ã—Ç–∞, –≤—ã–∏–≥—Ä—ã—à–∞, –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞)

---

## üóÑÔ∏è –≠–¢–ê–ü 1: –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ –ë–î (2-3 —á–∞—Å–∞)

### –¢–ê–ë–õ–ò–¶–ê 1: users_balance (–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```sql
CREATE TABLE users_balance (
    user_id VARCHAR(20) PRIMARY KEY,
    balance DECIMAL(15,2) NOT NULL DEFAULT 0.00,
    total_deposited DECIMAL(15,2) DEFAULT 0.00,
    total_withdrawn DECIMAL(15,2) DEFAULT 0.00,
    currency VARCHAR(3) DEFAULT 'USD',
    updated_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

–î–∞–Ω–Ω—ã–µ:
user_id   | balance  | total_deposited | total_withdrawn | currency
user_123  | 5000.00  | 10000.00        | 5000.00         | USD
user_456  | 250.50   | 1000.00         | 749.50          | USD
user_789  | 12500.00 | 50000.00        | 37500.00        | USD

–ó–∞—á–µ–º:
- –•—Ä–∞–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ß—Ç–æ–±—ã –∑–Ω–∞—Ç—å –º–æ–∂–µ—Ç –ª–∏ –æ–Ω —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –Ω–∞ —Å—É–º–º—É X
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥—ã –¥–µ–Ω–µ–≥
```

### –¢–ê–ë–õ–ò–¶–ê 2: bets (–°—Ç–∞–≤–∫–∏)

```sql
CREATE TABLE bets (
    bet_id SERIAL PRIMARY KEY,
    user_id VARCHAR(20) NOT NULL,
    event_id INTEGER NOT NULL,
    odds_id INTEGER NOT NULL,
    bet_type VARCHAR(10),
    bet_amount DECIMAL(15,2) NOT NULL,
    coefficient DECIMAL(10,2) NOT NULL,
    potential_win DECIMAL(15,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'open',
    result VARCHAR(20),
    actual_win DECIMAL(15,2),
    placed_at TIMESTAMP DEFAULT NOW(),
    resolved_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (event_id) REFERENCES events(event_id),
    FOREIGN KEY (odds_id) REFERENCES odds(odds_id)
);

–î–∞–Ω–Ω—ã–µ:
bet_id | user_id   | event_id | odds_id | bet_type | bet_amount | coefficient | potential_win | status   | result
1      | user_123  | 1        | 1       | 1        | 100.00     | 1.85        | 185.00        | open     | NULL
2      | user_123  | 2        | 4       | 1        | 50.00      | 2.10        | 105.00        | resolved | win
3      | user_456  | 1        | 2       | X        | 200.00     | 3.40        | 680.00        | resolved | loss
4      | user_789  | 3        | 6       | 2        | 1000.00    | 3.20        | 3200.00       | open     | NULL

–°—Ç–æ–ª–±—Ü—ã:
- status: "open" (—Å—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞), "resolved" (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω), "cancelled" (–æ—Ç–º–µ–Ω–µ–Ω–∞)
- result: "win" (–≤—ã–∏–≥—Ä—ã—à), "loss" (–ø—Ä–æ–∏–≥—Ä—ã—à), "void" (–∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞)
- actual_win: —Ä–µ–∞–ª—å–Ω–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª)
- coefficient: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–∞–≤–∫–∏ (–≤–¥—Ä—É–≥ –æ–Ω –ø–æ–∑–∂–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è)

–ó–∞—á–µ–º:
- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–≥–¥–∞ —Å–æ–±—ã—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è ‚Üí –æ–±–Ω–æ–≤–∏–º status –∏ result
```

### –¢–ê–ë–õ–ò–¶–ê 3: coupons (–ö—É–ø–æ–Ω—ã —Å—Ç–∞–≤–æ–∫)

```sql
CREATE TABLE coupons (
    coupon_id SERIAL PRIMARY KEY,
    user_id VARCHAR(20) NOT NULL,
    coupon_code VARCHAR(20) UNIQUE NOT NULL,
    total_bet_amount DECIMAL(15,2) NOT NULL,
    total_potential_win DECIMAL(15,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'open',
    result VARCHAR(20),
    actual_win DECIMAL(15,2),
    number_of_bets INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    resolved_at TIMESTAMP,
    updated_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

–î–∞–Ω–Ω—ã–µ:
coupon_id | user_id   | coupon_code | total_bet | total_potential | status   | result | actual_win | number_of_bets
1         | user_123  | CPN20251215 | 150.00    | 290.00          | open     | NULL   | NULL       | 2
2         | user_456  | CPN20251216 | 300.00    | 1200.00         | resolved | loss   | 0.00       | 3
3         | user_789  | CPN20251217 | 2000.00   | 5500.00         | open     | NULL   | NULL       | 5

–°—Ç–æ–ª–±—Ü—ã:
- coupon_code: –∫–æ–¥ –≤—Ä–æ–¥–µ "CPN20251215_ABC123" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- number_of_bets: —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –≤ —ç—Ç–æ–º –∫—É–ø–æ–Ω–µ
- –ï—Å–ª–∏ –≤ –∫—É–ø–æ–Ω–µ 5 —Å—Ç–∞–≤–æ–∫ –∏ 4 –≤—ã–∏–≥—Ä–∞–ª–∏, –∞ 1 –ø—Ä–æ–∏–≥—Ä–∞–ª–∞ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç = "loss"

–ó–∞—á–µ–º:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –≤ –∫—É–ø–æ–Ω
- –ö—É–ø–æ–Ω –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–°–ï —Å—Ç–∞–≤–∫–∏ –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç
- –≠—Ç–æ –∫–∞–∫ "—ç–∫—Å–ø—Ä–µ—Å—Å" —Å—Ç–∞–≤–∫–∞ - –≤—ã—à–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –≤—ã—à–µ —Ä–∏—Å–∫
```

### –¢–ê–ë–õ–ò–¶–ê 4: coupon_bets (–°–≤—è–∑—å –∫—É–ø–æ–Ω–∞ –∏ —Å—Ç–∞–≤–æ–∫)

```sql
CREATE TABLE coupon_bets (
    coupon_bet_id SERIAL PRIMARY KEY,
    coupon_id INTEGER NOT NULL,
    bet_id INTEGER NOT NULL,
    FOREIGN KEY (coupon_id) REFERENCES coupons(coupon_id),
    FOREIGN KEY (bet_id) REFERENCES bets(bet_id)
);

–î–∞–Ω–Ω—ã–µ:
coupon_bet_id | coupon_id | bet_id
1             | 1         | 1
2             | 1         | 2
3             | 2         | 3
4             | 2         | 4
5             | 2         | 5

–ó–∞—á–µ–º:
- –°–≤—è–∑—å –º–µ–∂–¥—É –∫—É–ø–æ–Ω–æ–º –∏ –µ–≥–æ —Å—Ç–∞–≤–∫–∞–º–∏
- –ö–æ–≥–¥–∞ —Å–æ–±—ã—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –≤ –∫—É–ø–æ–Ω–µ
- –ï—Å–ª–∏ –≤—Å–µ –≤—ã–∏–≥—Ä—ã—à–∏ ‚Üí –≤—ã–∏–≥—Ä—ã—à –∫—É–ø–æ–Ω–∞
```

### –¢–ê–ë–õ–ò–¶–ê 5: bet_transactions (–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

```sql
CREATE TABLE bet_transactions (
    transaction_id SERIAL PRIMARY KEY,
    user_id VARCHAR(20) NOT NULL,
    bet_id INTEGER,
    transaction_type VARCHAR(20),
    amount DECIMAL(15,2) NOT NULL,
    balance_before DECIMAL(15,2),
    balance_after DECIMAL(15,2),
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (bet_id) REFERENCES bets(bet_id)
);

–î–∞–Ω–Ω—ã–µ:
transaction_id | user_id   | bet_id | transaction_type | amount  | balance_before | balance_after | description
1              | user_123  | 1      | bet_placed       | -100.00 | 5100.00        | 5000.00       | –°—Ç–∞–≤–∫–∞ –Ω–∞ Man Utd
2              | user_123  | 2      | bet_won          | 105.00  | 5000.00        | 5105.00       | –í—ã–∏–≥—Ä—ã—à —Å—Ç–∞–≤–∫–∏ #2
3              | user_456  | 3      | bet_lost         | 0.00    | 250.50         | 250.50        | –ü—Ä–æ–∏–≥—Ä—ã—à —Å—Ç–∞–≤–∫–∏ #3
4              | user_789  | NULL   | deposit          | 1000.00 | 11500.00       | 12500.00      | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞

–°—Ç–æ–ª–±—Ü—ã:
- transaction_type: "bet_placed" (—Å—Ç–∞–≤–∫–∞), "bet_won" (–≤—ã–∏–≥—Ä—ã—à), "bet_lost" (–ø—Ä–æ–∏–≥—Ä—ã—à), "deposit" (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ), "withdrawal" (–≤—ã–≤–æ–¥)
- –í—Å—ë –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å

–ó–∞—á–µ–º:
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–Ω–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê—É–¥–∏—Ç: –∫—Ç–æ –∫–æ–≥–¥–∞ –∏ —Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–∞–≤–∏–ª/–≤—ã–∏–≥—Ä–∞–ª/–ø—Ä–æ–∏–≥—Ä–∞–ª
- –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏: –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å —Å –¥–µ–Ω—å–≥–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –¢–ê–ë–õ–ò–¶–ê 6: bet_results (–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π)

```sql
CREATE TABLE bet_results (
    result_id SERIAL PRIMARY KEY,
    event_id INTEGER NOT NULL,
    winning_bet_type VARCHAR(10),
    home_score INTEGER,
    away_score INTEGER,
    resolved_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (event_id) REFERENCES events(event_id)
);

–î–∞–Ω–Ω—ã–µ:
result_id | event_id | winning_bet_type | home_score | away_score | resolved_at
1         | 1        | 1                | 2          | 1          | 2025-12-15 20:45
2         | 2        | X                | 1          | 1          | 2025-12-15 21:30
3         | 3        | 2                | 1          | 3          | 2025-12-16 17:50

–°—Ç–æ–ª–±—Ü—ã:
- winning_bet_type: –∫–∞–∫–æ–π –∏—Å—Ö–æ–¥ –≤—ã–∏–≥—Ä–∞–ª ("1" = –ø–æ–±–µ–¥–∞ –¥–æ–º–∞, "X" = –Ω–∏—á—å—è, "2" = –ø–æ–±–µ–¥–∞ –≤ –≥–æ—Å—Ç—è—Ö)
- home_score, away_score: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç –º–∞—Ç—á–∞

–ó–∞—á–µ–º:
- –ö–æ–≥–¥–∞ —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚Üí –∑–Ω–∞–µ–º –∫–∞–∫–æ–π –±—ã–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–∞/–ø—Ä–æ–∏–≥—Ä—ã—à–∞
```

### –ß–¢–û –î–û–õ–ñ–ù–û –ü–û–õ–£–ß–ò–¢–¨–°–Ø?

```
PostgreSQL –±–∞–∑–∞ "looseline":

‚úÖ users_balance (–±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
‚úÖ bets (–≤—Å–µ —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
‚úÖ coupons (–∫—É–ø–æ–Ω—ã —Å –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ —Å—Ç–∞–≤–æ–∫)
‚úÖ coupon_bets (—Å–≤—è–∑—å –∫—É–ø–æ–Ω–æ–≤ –∏ —Å—Ç–∞–≤–æ–∫)
‚úÖ bet_transactions (–∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
‚úÖ bet_results (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ FOREIGN KEY
–ì–æ—Ç–æ–≤–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã!
```

---

## üîå –≠–¢–ê–ü 2: –°–û–ó–î–ê–ù–ò–ï 5 –ö–õ–Æ–ß–ï–í–´–• –ú–ï–¢–û–î–û–í (5-7 —á–∞—Å–æ–≤)

### **–ú–ï–¢–û–î 1: placeBet()**

### –ß–¢–û –≠–¢–û?

–ú–µ—Ç–æ–¥ —Ä–∞–∑–º–µ—â–∞–µ—Ç —Å—Ç–∞–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ü–ê–†–ê–ú–ï–¢–†–´:

```python
def placeBet(
    user_id: str,           # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    event_id: int,          # –∫–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ
    odds_id: int,           # –∫–∞–∫–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª
    bet_amount: float,      # —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (100.00)
    bet_type: str = None    # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
):
```

### –ß–¢–û –û–ù –î–û–õ–ñ–ï–ù –í–û–ó–í–†–ê–©–ê–¢–¨?

```json
{
  "success": true,
  "message": "–°—Ç–∞–≤–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ",
  "bet": {
    "bet_id": 1,
    "user_id": "user_123",
    "event_id": 1,
    "odds_id": 1,
    "bet_amount": 100.00,
    "coefficient": 1.85,
    "potential_win": 185.00,
    "status": "open",
    "placed_at": "2025-12-15T10:30:00Z"
  },
  "user_balance": {
    "balance_before": 5100.00,
    "balance_after": 5000.00,
    "amount_spent": 100.00
  }
}
```

### –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ï–¢–û–î?

```
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   SELECT * FROM users WHERE id = 'user_123'
   
   –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 404
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ:
   SELECT * FROM events WHERE event_id = 1
   
   –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∞ 404
   ‚Üì
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è:
   if event.status != 'scheduled':
       return error("–°–æ–±—ã—Ç–∏–µ –Ω–µ scheduled")
   (–Ω–µ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ live –∏–ª–∏ finished —Å–æ–±—ã—Ç–∏—è)
   ‚Üì
4. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:
   SELECT coefficient FROM odds WHERE odds_id = 1
   ‚Üì
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   SELECT balance FROM users_balance WHERE user_id = 'user_123'
   
   if balance < bet_amount:
       return error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥")
   ‚Üì
6. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º—É–º –∏ –º–∞–∫—Å–∏–º—É–º —Å—Ç–∞–≤–∫–∏:
   if bet_amount < 1.00:
       return error("–ú–∏–Ω–∏–º—É–º —Å—Ç–∞–≤–∫–∏: 1.00")
   if bet_amount > 100000.00:
       return error("–ú–∞–∫—Å–∏–º—É–º —Å—Ç–∞–≤–∫–∏: 100000.00")
   ‚Üì
7. –†–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à:
   potential_win = bet_amount * coefficient
   
   –ü—Ä–∏–º–µ—Ä: 100 * 1.85 = 185.00
   ‚Üì
8. –°–æ–∑–¥–∞—ë—Ç —Å—Ç–∞–≤–∫—É –≤ –ë–î:
   INSERT INTO bets 
   (user_id, event_id, odds_id, bet_amount, coefficient, potential_win, status)
   VALUES ('user_123', 1, 1, 100.00, 1.85, 185.00, 'open')
   
   –ü–æ–ª—É—á–∞–µ—Ç bet_id = 1
   ‚Üì
9. –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã—á–∏—Ç–∞–µ—Ç —Å—Ç–∞–≤–∫—É):
   UPDATE users_balance 
   SET balance = balance - 100.00
   WHERE user_id = 'user_123'
   
   –ë–∞–ª–∞–Ω—Å: 5100.00 ‚Üí 5000.00
   ‚Üì
10. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
    INSERT INTO bet_transactions
    (user_id, bet_id, transaction_type, amount, balance_before, balance_after, description)
    VALUES ('user_123', 1, 'bet_placed', -100.00, 5100.00, 5000.00, '–°—Ç–∞–≤–∫–∞ –Ω–∞ Man Utd (1.85)')
    ‚Üì
11. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å—Ç–∞–≤–∫–∏
```

### –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```
Frontend (–ê–ª–∏–Ω–∞) –≤—ã–∑—ã–≤–∞–µ—Ç:
POST /api/bets/place
{
  "user_id": "user_123",
  "event_id": 1,
  "odds_id": 1,
  "bet_amount": 100.00
}

Backend (–¢—Ä–µ—Ç–∏–π) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
placeBet('user_123', 1, 1, 100.00)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "success": true,
  "bet_id": 1,
  "potential_win": 185.00,
  "balance_after": 5000.00
}

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
"‚úÖ –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!"
"–í–∞—à –≤—ã–∏–≥—Ä—ã—à –º–æ–∂–µ—Ç –±—ã—Ç—å: 185.00 USD"
"–ë–∞–ª–∞–Ω—Å: 5000.00 USD"
```

---

### **–ú–ï–¢–û–î 2: calculatePotentialWin()**

### –ß–¢–û –≠–¢–û?

–ú–µ—Ç–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö.

### –ü–ê–†–ê–ú–ï–¢–†–´:

```python
def calculatePotentialWin(
    bet_amount: float,      # —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏
    coefficient: float,     # –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (1.85, 2.10, –∏ —Ç.–¥)
    coupon_bets: list = None  # –µ—Å–ª–∏ —ç—Ç–æ –∫—É–ø–æ–Ω, —Å–ø–∏—Å–æ–∫ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
):
```

### –ß–¢–û –û–ù –î–û–õ–ñ–ï–ù –í–û–ó–í–†–ê–©–ê–¢–¨?

```json
{
  "single_bet": {
    "bet_amount": 100.00,
    "coefficient": 1.85,
    "potential_win": 185.00,
    "profit": 85.00
  },
  "coupon": {
    "bet_amount": 150.00,
    "coefficients": [1.85, 2.10, 3.40],
    "total_coefficient": 13.25,
    "potential_win": 1987.50,
    "profit": 1837.50
  }
}
```

### –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ï–¢–û–î?

```
–í–ê–†–ò–ê–ù–¢ 1: –û–¥–∏–Ω–æ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞

1. –ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   bet_amount = 100.00
   coefficient = 1.85
   ‚Üì
2. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:
   if coefficient < 1.01:
       return error("–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å < 1.01")
   ‚Üì
3. –†–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
   potential_win = bet_amount * coefficient
   = 100.00 * 1.85 = 185.00
   
   profit = potential_win - bet_amount
   = 185.00 - 100.00 = 85.00
   ‚Üì
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

–í–ê–†–ò–ê–ù–¢ 2: –ö—É–ø–æ–Ω (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫)

1. –ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   bet_amount = 150.00
   coupon_bets = [
     { coefficient: 1.85 },
     { coefficient: 2.10 },
     { coefficient: 3.40 }
   ]
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞–ª–∏–¥–µ–Ω
   ‚Üì
3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –û–ë–©–ò–ô –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ):
   total_coefficient = 1.85 * 2.10 * 3.40
   = 13.251
   ‚Üì
4. –†–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à:
   potential_win = bet_amount * total_coefficient
   = 150.00 * 13.251 = 1987.65
   
   profit = 1987.65 - 150.00 = 1837.65
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

### –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```
–ü–†–ò–ú–ï–† 1: –û–¥–∏–Ω–æ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: –°—Ç–∞–≤–ª—é 100 USD –Ω–∞ Man Utd (1.85)

Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
POST /api/bets/calculate
{
  "bet_amount": 100.00,
  "coefficient": 1.85
}

Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
calculatePotentialWin(100.00, 1.85)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "bet_amount": 100.00,
  "coefficient": 1.85,
  "potential_win": 185.00,
  "profit": 85.00
}

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: 100.00 USD
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 1.85
–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: 185.00 USD
–í–∞—à–∞ –ø—Ä–∏–±—ã–ª—å: 85.00 USD

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

–ü–†–ò–ú–ï–† 2: –ö—É–ø–æ–Ω –∏–∑ 3 —Å—Ç–∞–≤–æ–∫ (–≠–∫—Å–ø—Ä–µ—Å—Å)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç 3 —Å–æ–±—ã—Ç–∏—è –∏ —Å—Ç–∞–≤–∏—Ç 150 USD:
1. Man Utd - Liverpool (1.85)
2. Real - Barcelona (2.10)
3. Arsenal - Chelsea (3.40)

Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
POST /api/bets/calculate/coupon
{
  "bet_amount": 150.00,
  "coefficients": [1.85, 2.10, 3.40]
}

Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
calculatePotentialWin(150.00, coupon_bets=[...])

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "bet_amount": 150.00,
  "coefficients": [1.85, 2.10, 3.40],
  "total_coefficient": 13.25,
  "potential_win": 1987.50,
  "profit": 1837.50
}

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: 150.00 USD
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (—ç–∫—Å–ø—Ä–µ—Å—Å): 13.25x
–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: 1987.50 USD
–í–∞—à–∞ –ø—Ä–∏–±—ã–ª—å: 1837.50 USD

‚ö†Ô∏è –í—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–∏–≥—Ä–∞—Ç—å, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å –∫—É–ø–æ–Ω!
```

---

### **–ú–ï–¢–û–î 3: createCoupon()**

### –ß–¢–û –≠–¢–û?

–ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞—ë—Ç –∫—É–ø–æ–Ω (—ç–∫—Å–ø—Ä–µ—Å—Å) –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–∞–≤–æ–∫.

### –ü–ê–†–ê–ú–ï–¢–†–´:

```python
def createCoupon(
    user_id: str,           # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    bet_ids: list,          # —Å–ø–∏—Å–æ–∫ ID —Å—Ç–∞–≤–æ–∫ [1, 2, 3]
    coupon_name: str = None # –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
):
```

### –ß–¢–û –û–ù –î–û–õ–ñ–ï–ù –í–û–ó–í–†–ê–©–ê–¢–¨?

```json
{
  "success": true,
  "message": "–ö—É–ø–æ–Ω —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ",
  "coupon": {
    "coupon_id": 1,
    "coupon_code": "CPN20251215_ABC",
    "user_id": "user_123",
    "bets": [
      { "bet_id": 1, "event_id": 1, "coefficient": 1.85 },
      { "bet_id": 2, "event_id": 2, "coefficient": 2.10 },
      { "bet_id": 3, "event_id": 3, "coefficient": 3.40 }
    ],
    "total_bet_amount": 150.00,
    "total_potential_win": 1987.50,
    "total_coefficient": 13.25,
    "status": "open",
    "number_of_bets": 3,
    "created_at": "2025-12-15T10:35:00Z"
  }
}
```

### –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ï–¢–û–î?

```
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
   SELECT * FROM bets WHERE bet_id IN (1, 2, 3) AND user_id = 'user_123'
   
   –ï—Å–ª–∏ –±–µ—Ç –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Üí –æ—à–∏–±–∫–∞ 403 (–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω)
   ‚Üì
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Å—Ç–∞–≤–∫–∏ —Ä–∞–∑–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:
   if all(bets[i].event_id != bets[j].event_id for i, j in combinations):
       ‚úÖ OK - —Ä–∞–∑–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   else:
       return error("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫—É–ø–æ–Ω –∏–∑ —Å—Ç–∞–≤–æ–∫ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è")
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ —Å—Ç–∞–≤–∫–∏ status = 'open':
   if any(bet.status != 'open' for bet in bets):
       return error("–í—Å–µ —Å—Ç–∞–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã (open)")
   ‚Üì
5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—É–ø–æ–Ω–∞:
   total_bet_amount = —Å—É–º–º–∞ –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫ –≤ –∫—É–ø–æ–Ω–µ = 100 + 50 = 150
   total_coefficient = –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ = 1.85 * 2.10 = 3.885
   total_potential_win = 150 * 3.885 = 582.75
   ‚Üì
6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ –∫—É–ø–æ–Ω–∞:
   coupon_code = "CPN" + timestamp + random = "CPN20251215_ABC123"
   ‚Üì
7. –°–æ–∑–¥–∞—ë—Ç –∫—É–ø–æ–Ω –≤ –ë–î:
   INSERT INTO coupons
   (user_id, coupon_code, total_bet_amount, total_potential_win, status, number_of_bets)
   VALUES ('user_123', 'CPN20251215_ABC', 150.00, 582.75, 'open', 2)
   
   –ü–æ–ª—É—á–∞–µ—Ç coupon_id = 1
   ‚Üì
8. –°–≤—è–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–≤–∫–∏ —Å –∫—É–ø–æ–Ω–æ–º:
   INSERT INTO coupon_bets (coupon_id, bet_id) VALUES (1, 1)
   INSERT INTO coupon_bets (coupon_id, bet_id) VALUES (1, 2)
   ‚Üì
9. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫—É–ø–æ–Ω–∞
```

### –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–°–æ–∑–¥–∞—Ç—å –∫—É–ø–æ–Ω"

Frontend –ø–æ–ª—É—á–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏:
bet_ids = [1, 2, 3]

Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
POST /api/bets/coupon/create
{
  "user_id": "user_123",
  "bet_ids": [1, 2, 3],
  "coupon_name": "–ú–æ–π —ç–∫—Å–ø—Ä–µ—Å—Å"
}

Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
createCoupon('user_123', [1, 2, 3])

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "coupon_id": 1,
  "coupon_code": "CPN20251215_ABC",
  "total_potential_win": 1987.50
}

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
"‚úÖ –ö—É–ø–æ–Ω —Å–æ–∑–¥–∞–Ω!"
"–ö–æ–¥: CPN20251215_ABC"
"–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: 1987.50 USD"
"‚ö†Ô∏è –î–ª—è –≤—ã–∏–≥—Ä—ã—à–∞ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–∏–≥—Ä–∞—Ç—å!"
```

---

### **–ú–ï–¢–û–î 4: calculatePotentialWin()**

### –ß–¢–û –≠–¢–û?

–ú–µ—Ç–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–≤—ã–∏–≥—Ä—ã—à/–ø—Ä–æ–∏–≥—Ä—ã—à) –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è.

### –ü–ê–†–ê–ú–ï–¢–†–´:

```python
def resolveBet(
    event_id: int,          # –∫–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–∏–ª–æ—Å—å
    winning_bet_type: str,  # "1", "X", –∏–ª–∏ "2"
    home_score: int,        # —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç –¥–æ–º–∞
    away_score: int         # —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç –≥–æ—Å—Ç–µ–π
):
```

### –ß–¢–û –û–ù –î–û–õ–ñ–ï–ù –í–û–ó–í–†–ê–©–ê–¢–¨?

```json
{
  "success": true,
  "message": "–°—Ç–∞–≤–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã",
  "event_id": 1,
  "winning_bet_type": "1",
  "resolved_count": 15,
  "results": {
    "wins": 12,
    "losses": 3,
    "total_paid": 2500.00
  }
}
```

### –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ï–¢–û–î?

```
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ:
   SELECT * FROM events WHERE event_id = 1
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è:
   if event.status != 'finished':
       return error("–°–æ–±—ã—Ç–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–æ (finished)")
   ‚Üì
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –µ—â—ë –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ:
   SELECT * FROM bet_results WHERE event_id = 1
   
   if result exists:
       return error("–≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ")
   ‚Üì
4. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç winning_bet_type:
   if winning_bet_type not in ["1", "X", "2"]:
       return error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å—Ç–∞–≤–∫–∏")
   ‚Üì
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–±—ã—Ç–∏—è:
   INSERT INTO bet_results
   (event_id, winning_bet_type, home_score, away_score)
   VALUES (1, "1", 2, 1)
   ‚Üì
6. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ:
   SELECT * FROM bets WHERE event_id = 1 AND status = 'open'
   
   (–¥–æ–ø—É—Å—Ç–∏–º –Ω–∞–π–¥–µ–Ω–æ 15 —Å—Ç–∞–≤–æ–∫)
   ‚Üì
7. –î–õ–Ø –ö–ê–ñ–î–û–ô –°–¢–ê–í–ö–ò:
   
   a) –ü–æ–ª—É—á–∞–µ—Ç –µ—ë odds:
      SELECT odds.bet_type, odds.coefficient FROM odds WHERE odds_id = bet.odds_id
   
   b) –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–∏–≥—Ä–∞–ª–∞ –ª–∏ —Å—Ç–∞–≤–∫–∞:
      if odds.bet_type == winning_bet_type:
          # –í–´–ò–ì–†–´–®!
          actual_win = bet.bet_amount * bet.coefficient
          status = "resolved"
          result = "win"
      else:
          # –ü–†–û–ò–ì–†–´–®!
          actual_win = 0
          status = "resolved"
          result = "loss"
   
   c) –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞–≤–∫—É –≤ –ë–î:
      UPDATE bets 
      SET status = 'resolved', result = 'win/loss', actual_win = ?
      WHERE bet_id = ?
   
   d) –ï—Å–ª–∏ –í–´–ò–ì–†–´–® ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
      UPDATE users_balance 
      SET balance = balance + actual_win
      WHERE user_id = bet.user_id
   
   e) –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
      INSERT INTO bet_transactions
      (user_id, bet_id, transaction_type, amount, ...)
      VALUES (user_id, bet_id, 'bet_won', actual_win, ...)
   ‚Üì
8. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–ø–æ–Ω—ã:
   SELECT * FROM coupon_bets cb
   JOIN coupons c ON cb.coupon_id = c.coupon_id
   WHERE cb.bet_id IN (–≤—Å–µ —Å—Ç–∞–≤–∫–∏ —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è)
   
   –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ö–£–ü–û–ù–ê:
   - –ï—Å–ª–∏ –í–°–ï —Å—Ç–∞–≤–∫–∏ –≤ –∫—É–ø–æ–Ω–µ –≤—ã–∏–≥—Ä—ã—à–∏ ‚Üí –∫—É–ø–æ–Ω –≤—ã–∏–≥—Ä—ã—à
   - –ï—Å–ª–∏ –•–û–¢–Ø –ë–´ –û–î–ù–ê —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä—ã—à ‚Üí –∫—É–ø–æ–Ω –ø—Ä–æ–∏–≥—Ä—ã—à
   
   (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ –∫—É–ø–æ–Ω–µ 3 —Å—Ç–∞–≤–∫–∏: 2 –≤—ã–∏–≥—Ä—ã—à–∞ + 1 –ø—Ä–æ–∏–≥—Ä—ã—à ‚Üí –∫—É–ø–æ–Ω –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç!)
   ‚Üì
9. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
   - —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –≤—ã–∏–≥—Ä–∞–ª–æ
   - —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª–æ
   - —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
```

### –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```
–ü–†–ò–ú–ï–†: –°–æ–±—ã—Ç–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å—Ç–∞–≤–∫–∏

–°–æ–±—ã—Ç–∏–µ #1: Man Utd vs Liverpool
–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: 2-1 (–ø–æ–±–µ–¥–∞ –¥–æ–º–∞)
Winning_bet_type: "1"

–ë—ã–ª–æ 15 —Å—Ç–∞–≤–æ–∫:
- 12 —Å—Ç–∞–≤–æ–∫ –Ω–∞ –ü1 (1) ‚Üí –í–´–ò–ì–†–´–®
- 2 —Å—Ç–∞–≤–∫–∏ –Ω–∞ X (–Ω–∏—á—å—è) ‚Üí –ü–†–û–ò–ì–†–´–®
- 1 —Å—Ç–∞–≤–∫–∞ –Ω–∞ –ü2 (2) ‚Üí –ü–†–û–ò–ì–†–´–®

Backend –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "finished":
resolveBet(event_id=1, winning_bet_type="1", home_score=2, away_score=1)

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–±—ã—Ç–∏—è –≤ bet_results
2. –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ 12 –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫:
   - status: 'open' ‚Üí 'resolved'
   - result: 'win'
   - actual_win: bet_amount * coefficient
   (–Ω–∞–ø—Ä–∏–º–µ—Ä: 100 * 1.85 = 185)

3. –í—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
   - user_123: –±–∞–ª–∞–Ω—Å +185
   - user_456: –±–∞–ª–∞–Ω—Å +210
   - ... –∏ —Ç.–¥

4. –û–±–Ω–æ–≤–ª—è–µ—Ç 3 –ø—Ä–æ–∏–≥—Ä—ã—à–Ω—ã–µ —Å—Ç–∞–≤–∫–∏:
   - status: 'open' ‚Üí 'resolved'
   - result: 'loss'
   - actual_win: 0

5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–ø–æ–Ω—ã —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "success": true,
  "wins": 12,
  "losses": 3,
  "total_paid": 2500.00
}

–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
- 12 –∑–∞–ø–∏—Å–µ–π "bet_won" —Å –≤—ã–ø–ª–∞—Ç–∞–º–∏
- 3 –∑–∞–ø–∏—Å–∏ "bet_lost"
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
```

---

### **–ú–ï–¢–û–î 5: updateBetStatus()**

### –ß–¢–û –≠–¢–û?

–ú–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏ (–æ—Ç–∫—Ä—ã—Ç–∞, –æ—Ç–º–µ–Ω–µ–Ω–∞, –∏ —Ç.–¥).

### –ü–ê–†–ê–ú–ï–¢–†–´:

```python
def updateBetStatus(
    bet_id: int,            # ID —Å—Ç–∞–≤–∫–∏
    new_status: str,        # "open", "resolved", "cancelled"
    reason: str = None      # –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
):
```

### –ß–¢–û –û–ù –î–û–õ–ñ–ï–ù –í–û–ó–í–†–ê–©–ê–¢–¨?

```json
{
  "success": true,
  "message": "–°—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏ –æ–±–Ω–æ–≤–ª—ë–Ω",
  "bet": {
    "bet_id": 1,
    "old_status": "open",
    "new_status": "cancelled",
    "bet_amount": 100.00,
    "refund_amount": 100.00,
    "reason": "–ú–∞—Ç—á –æ—Ç–º–µ–Ω—ë–Ω"
  }
}
```

### –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ï–¢–û–î?

```
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å—Ç–∞–≤–∫–∞:
   SELECT * FROM bets WHERE bet_id = 1
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
   if bet.status == 'resolved':
       return error("–ù–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–π —Å—Ç–∞–≤–∫–∏")
   ‚Üì
3. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:
   if new_status not in ["open", "cancelled", "resolved"]:
       return error("–ù–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å")
   ‚Üì
4. –ï–°–õ –û–¢–ú–ï–ù–ê (new_status = "cancelled"):
   
   a) –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–≤–∫–µ:
      bet_amount = 100.00
      user_id = "user_123"
   
   b) –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ–Ω—å–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
      UPDATE users_balance 
      SET balance = balance + 100.00
      WHERE user_id = "user_123"
   
   c) –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞–≤–∫—É:
      UPDATE bets 
      SET status = 'cancelled', updated_at = NOW()
      WHERE bet_id = 1
   
   d) –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–≤–æ–∑–≤—Ä–∞—Ç):
      INSERT INTO bet_transactions
      (user_id, bet_id, transaction_type, amount, description)
      VALUES ('user_123', 1, 'bet_cancelled', 100.00, '–ú–∞—Ç—á –æ—Ç–º–µ–Ω—ë–Ω')
   
   e) –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–ø–æ–Ω—ã (–µ—Å–ª–∏ —ç—Ç–∞ —Å—Ç–∞–≤–∫–∞ –≤ –∫—É–ø–æ–Ω–µ):
      - –û—Ç–º–µ—á–∞–µ—Ç –∫—É–ø–æ–Ω –∫–∞–∫ "void" (–∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω)
      - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å—é —Å—É–º–º—É –∫—É–ø–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚Üì
5. –ï–°–õ –û–¢–ö–†–´–¢–ò–ï –ó–ê–ù–û–í–û:
   
   (–µ—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞, –ø–æ—Ç–æ–º —Ä–µ—à–∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –µ—ë —Å–Ω–æ–≤–∞)
   
   a) –í—ã—á–∏—Ç–∞–µ—Ç –¥–µ–Ω—å–≥–∏ –∏–∑ –±–∞–ª–∞–Ω—Å–∞:
      UPDATE users_balance 
      SET balance = balance - 100.00
      WHERE user_id = 'user_123'
   
   b) –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞–≤–∫—É:
      UPDATE bets 
      SET status = 'open', updated_at = NOW()
      WHERE bet_id = 1
   
   c) –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
      INSERT INTO bet_transactions
      (user_id, bet_id, transaction_type, amount, description)
      VALUES ('user_123', 1, 'bet_reopened', -100.00, '–°—Ç–∞–≤–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∑–∞–Ω–æ–≤–æ')
   ‚Üì
6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
```

### –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```
–ü–†–ò–ú–ï–† 1: –û—Ç–º–µ–Ω–∞ —Å—Ç–∞–≤–∫–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥—É–º–∞–ª)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–û—Ç–º–µ–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É" –Ω–∞ —Å—Ç–∞–≤–∫–µ #1

Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
POST /api/bets/1/cancel
{
  "reason": "–ü–µ—Ä–µ–¥—É–º–∞–ª"
}

Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
updateBetStatus(bet_id=1, new_status='cancelled', reason='–ü–µ—Ä–µ–¥—É–º–∞–ª')

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Å—Ç–∞–≤–∫–∞ status = 'open'
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 100.00 USD –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏ –Ω–∞ 'cancelled'
4. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "success": true,
  "refund_amount": 100.00
}

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
"‚úÖ –°—Ç–∞–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –í–∞–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ 100.00 USD"

–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 5000.00 ‚Üí 5100.00

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

–ü–†–ò–ú–ï–† 2: –û—Ç–º–µ–Ω–∞ —Å–æ–±—ã—Ç–∏—è (–∞–¥–º–∏–Ω –æ—Ç–º–µ–Ω—è–µ—Ç –º–∞—Ç—á)

–ê–¥–º–∏–Ω –æ—Ç–º–µ–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä –º–∞—Ç—á –æ—Ç–ª–æ–∂–µ–Ω)

Backend –≤—ã–∑—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –í–°–ï —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ:
SELECT * FROM bets WHERE event_id = 1 AND status = 'open'

–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–≤–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç:
updateBetStatus(bet_id, 'cancelled', reason='–ú–∞—Ç—á –æ—Ç–º–µ–Ω—ë–Ω')

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –í–°–ï 15 —Å—Ç–∞–≤–æ–∫ –æ—Ç–º–µ–Ω–µ–Ω—ã
- –í—Å–µ–º 15 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –¥–µ–Ω—å–≥–∏
- –ó–∞–ø–∏—Å–∞–Ω–æ 15 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π "bet_cancelled"

Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
"‚ö†Ô∏è –ú–∞—Ç—á –æ—Ç–º–µ–Ω—ë–Ω. –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞: 100.00 USD"
```

---

## üìä –≠–¢–ê–ü 3: –î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–ù–ò–ï –ö–û–î–ê (1-2 —á–∞—Å–∞)

### –ß–¢–û –¢–†–ï–¢–ò–ô –î–û–õ–ñ–ï–ù –ù–ê–ü–ò–°–ê–¢–¨?

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞:**

```python
def placeBet(
    user_id: str,
    event_id: int,
    odds_id: int,
    bet_amount: float,
    bet_type: str = None
) -> dict:
    """
    –†–∞–∑–º–µ—â–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ç–∞–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ.
    
    –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è,
    —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è, –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏ —Å—É–º–º —Å—Ç–∞–≤–∫–∏.
    –í—ã—á–∏—Ç–∞–µ—Ç –¥–µ–Ω—å–≥–∏ –∏–∑ –±–∞–ª–∞–Ω—Å–∞ –∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î.
    
    Args:
        user_id (str): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users.
        event_id (int): ID —Å–æ–±—ã—Ç–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã events.
        odds_id (int): ID –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã odds.
        bet_amount (float): –°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ –≤ USD. –î–∏–∞–ø–∞–∑–æ–Ω: 1.00 - 100000.00
        bet_type (str, optional): –¢–∏–ø —Å—Ç–∞–≤–∫–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ("1", "X", "2").
            Defaults to None.
    
    Returns:
        dict: –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏:
            - success (bool): –ë—ã–ª–∞ –ª–∏ —Å—Ç–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω–∞
            - message (str): –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            - bet (dict): –î–µ—Ç–∞–ª–∏ —Ä–∞–∑–º–µ—â—ë–Ω–Ω–æ–π —Å—Ç–∞–≤–∫–∏
              - bet_id (int): ID –Ω–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏
              - coefficient (float): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
              - potential_win (float): –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à
              - status (str): "open"
            - user_balance (dict):
              - balance_before (float): –ë–∞–ª–∞–Ω—Å –¥–æ —Å—Ç–∞–≤–∫–∏
              - balance_after (float): –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å—Ç–∞–≤–∫–∏
    
    Raises:
        ValueError: –ï—Å–ª–∏ user_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        ValueError: –ï—Å–ª–∏ event_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        ValueError: –ï—Å–ª–∏ event —Å—Ç–∞—Ç—É—Å != 'scheduled'
        ValueError: –ï—Å–ª–∏ bet_amount < 1.00 –∏–ª–∏ > 100000.00
        ValueError: –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è < bet_amount
        ValueError: –ï—Å–ª–∏ odds_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        DatabaseError: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    
    Examples:
        >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–≤–∏—Ç 100 USD –Ω–∞ Man Utd (–∫–æ—ç—Ñ—Ñ 1.85)
        >>> result = placeBet(
        ...     user_id='user_123',
        ...     event_id=1,
        ...     odds_id=1,
        ...     bet_amount=100.00
        ... )
        >>> print(result['bet']['potential_win'])
        185.0
        >>> print(result['user_balance']['balance_after'])
        5000.0
    
    Database Queries:
        1. SELECT * FROM users WHERE id = ?
        2. SELECT * FROM users_balance WHERE user_id = ?
        3. SELECT * FROM events WHERE event_id = ?
        4. SELECT coefficient FROM odds WHERE odds_id = ?
        5. INSERT INTO bets (...)
        6. UPDATE users_balance SET balance = ... WHERE user_id = ?
        7. INSERT INTO bet_transactions (...)
    
    Performance:
        - –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å: 50-80ms
        - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –ë–î
    
    Constraints:
        - –ú–∏–Ω–∏–º—É–º —Å—Ç–∞–≤–∫–∏: 1.00 USD
        - –ú–∞–∫—Å–∏–º—É–º —Å—Ç–∞–≤–∫–∏: 100000.00 USD
        - –¢–æ–ª—å–∫–æ –¥–ª—è status = 'scheduled' —Å–æ–±—ã—Ç–∏–π
        - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥
    
    Notes:
        - –î–µ–Ω—å–≥–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –°–†–ê–ó–£ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏
        - –í—ã–∏–≥—Ä—ã—à –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (resolved)
        - –°—Ç–∞–≤–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞ (cancelled) –¥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
    """
```

### –ß–¢–û –ï–©–Å –î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨?

-  **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint

-  **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** (–ø—Ä–æ—Å—Ç—ã–µ –∏ —Å–ª–æ–∂–Ω—ã–µ)

-  **–û—à–∏–±–∫–∏** –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å

-  **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞)

-  **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** (–º–∏–Ω–∏–º—É–º, –º–∞–∫—Å–∏–º—É–º —Å—Ç–∞–≤–æ–∫)

-  **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (–∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–µ–Ω—å–≥–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—É–ø–æ–Ω—ã)

---

## ‚úÖ –≠–¢–ê–ü 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (2-3 —á–∞—Å–∞)

### –ß–¢–û –¢–†–ï–¢–ò–ô –î–û–õ–ñ–ï–ù –ù–ê–ü–ò–°–ê–¢–¨?

–ú–∏–Ω–∏–º—É–º **3 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞.

### –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–ï–¢–û–î–ê: placeBet()

**–¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å user_123 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ï–≥–æ –±–∞–ª–∞–Ω—Å = 5100.00 USD
- –°–æ–±—ã—Ç–∏–µ #1 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å—Ç–∞—Ç—É—Å = "scheduled"
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç #1 = 1.85

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
placeBet(
    user_id='user_123',
    event_id=1,
    odds_id=1,
    bet_amount=100.00
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
{
  "success": true,
  "bet_id": 1,
  "potential_win": 185.00
}

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –í —Ç–∞–±–ª–∏—Ü–µ bets –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å (ID 1)
‚úÖ bet.status = "open"
‚úÖ bet.coefficient = 1.85
‚úÖ bet.potential_win = 185.00
‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 5100.00 ‚Üí 5000.00 (–≤—ã—á—Ç–µ–Ω–æ 100)
‚úÖ –í bet_transactions –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å —Ç–∏–ø–∞ "bet_placed"
```

**–¢–µ—Å—Ç 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–æ—à–∏–±–∫–∞)**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = 50.00 USD
- –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å 100.00 USD

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
placeBet(
    user_id='user_789',
    event_id=1,
    odds_id=1,
    bet_amount=100.00
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–û—à–∏–±–∫–∞ 400:
{
  "error": "Insufficient balance. You have 50.00, but need 100.00"
}

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –°—Ç–∞–≤–∫–∞ –ù–ï —Å–æ–∑–¥–∞–Ω–∞
‚úÖ –ë–∞–ª–∞–Ω—Å –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è
‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï –∑–∞–ø–∏—Å–∞–Ω–∞
‚úÖ –í–µ—Ä–Ω—É–ª–∞—Å—å –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
```

**–¢–µ—Å—Ç 3: –°–æ–±—ã—Ç–∏–µ –Ω–µ scheduled (–æ—à–∏–±–∫–∞)**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –°–æ–±—ã—Ç–∏–µ #2 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ù–æ –µ–≥–æ —Å—Ç–∞—Ç—É—Å = "finished" (—É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ)

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
placeBet(
    user_id='user_123',
    event_id=2,
    odds_id=2,
    bet_amount=100.00
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–û—à–∏–±–∫–∞ 400:
{
  "error": "Cannot bet on finished events"
}

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –°—Ç–∞–≤–∫–∞ –ù–ï —Å–æ–∑–¥–∞–Ω–∞
‚úÖ –ë–∞–ª–∞–Ω—Å –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è
```

---

### –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–ï–¢–û–î–ê: calculatePotentialWin()

**–¢–µ—Å—Ç 1: –û–¥–∏–Ω–æ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞**

```
–®–ê–ì 1: –î–µ–π—Å—Ç–≤–∏–µ
calculatePotentialWin(
    bet_amount=100.00,
    coefficient=1.85
)

–®–ê–ì 2: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
{
  "bet_amount": 100.00,
  "coefficient": 1.85,
  "potential_win": 185.00,
  "profit": 85.00
}

–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ potential_win = 100 * 1.85 = 185
‚úÖ profit = 185 - 100 = 85
‚úÖ –†–∞—Å—á—ë—Ç—ã –≤–µ—Ä–Ω—ã–µ
```

**–¢–µ—Å—Ç 2: –ö—É–ø–æ–Ω (—ç–∫—Å–ø—Ä–µ—Å—Å) –∏–∑ 3 —Å—Ç–∞–≤–æ–∫**

```
–®–ê–ì 1: –î–µ–π—Å—Ç–≤–∏–µ
calculatePotentialWin(
    bet_amount=150.00,
    coupon_bets=[
        {"coefficient": 1.85},
        {"coefficient": 2.10},
        {"coefficient": 3.40}
    ]
)

–®–ê–ì 2: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
{
  "bet_amount": 150.00,
  "total_coefficient": 13.251,
  "potential_win": 1987.65,
  "profit": 1837.65
}

–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ total_coefficient = 1.85 * 2.10 * 3.40 = 13.251
‚úÖ potential_win = 150 * 13.251 = 1987.65
‚úÖ profit = 1987.65 - 150 = 1837.65
‚úÖ –†–∞—Å—á—ë—Ç—ã –≤–µ—Ä–Ω—ã–µ
```

---

### –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–ï–¢–û–î–ê: resolveBet()

**–¢–µ—Å—Ç 1: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è - –≤—ã–∏–≥—Ä—ã—à–∏ –∏ –ø—Ä–æ–∏–≥—Ä—ã—à–∏**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –°–æ–±—ã—Ç–∏–µ #1: Man Utd vs Liverpool
- –ë—ã–ª–æ 15 —Å—Ç–∞–≤–æ–∫ –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ:
  - 12 –Ω–∞ –ü1 (bet_amount: 100, coefficient: 1.85)
  - 2 –Ω–∞ X (bet_amount: 200, coefficient: 3.40)
  - 1 –Ω–∞ –ü2 (bet_amount: 50, coefficient: 4.10)

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
resolveBet(
    event_id=1,
    winning_bet_type="1",
    home_score=2,
    away_score=1
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
{
  "success": true,
  "wins": 12,
  "losses": 3,
  "total_paid": 2220.00
}

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –í bet_results –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å (winning_bet_type="1")
‚úÖ 12 —Å—Ç–∞–≤–æ–∫ –Ω–∞ –ü1 –æ–±–Ω–æ–≤–ª–µ–Ω—ã: status='resolved', result='win'
‚úÖ –î–ª—è –∫–∞–∂–¥–æ–π –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π —Å—Ç–∞–≤–∫–∏: actual_win = 100 * 1.85 = 185
‚úÖ 12 * 185 = 2220 –≤—ã–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
‚úÖ 2 —Å—Ç–∞–≤–∫–∏ –Ω–∞ X –æ–±–Ω–æ–≤–ª–µ–Ω—ã: status='resolved', result='loss'
‚úÖ 1 —Å—Ç–∞–≤–∫–∞ –Ω–∞ –ü2 –æ–±–Ω–æ–≤–ª–µ–Ω–∞: status='resolved', result='loss'
‚úÖ –î–ª—è –ø—Ä–æ–∏–≥—Ä—ã—à–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫: actual_win = 0
‚úÖ –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±–Ω–æ–≤–ª–µ–Ω—ã
‚úÖ 15 –∑–∞–ø–∏—Å–µ–π –≤ bet_transactions (12 –≤—ã–∏–≥—Ä—ã—à–µ–π + 3 –ø—Ä–æ–∏–≥—Ä—ã—à–∞)
```

**–¢–µ—Å—Ç 2: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Å –∫—É–ø–æ–Ω–∞–º–∏**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –ö—É–ø–æ–Ω #1 —Å–æ–¥–µ—Ä–∂–∏—Ç 3 —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è #1, #2, #3
- –°–æ–±—ã—Ç–∏–µ #1 —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (–≤—ã–∏–≥—Ä—ã—à)
- –°–æ–±—ã—Ç–∏–µ #2 —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (–≤—ã–∏–≥—Ä—ã—à)
- –°–æ–±—ã—Ç–∏–µ #3 —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (–ü–†–û–ò–ì–†–´–®!)

–®–ê–ì 2: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°—Ç–∞–≤–∫–∞ 1: resolved, win
- –°—Ç–∞–≤–∫–∞ 2: resolved, win
- –°—Ç–∞–≤–∫–∞ 3: resolved, loss

- –ö—É–ø–æ–Ω #1: resolved, loss (–ø–æ—Ç–æ–º—É —á—Ç–æ 1 —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞!)

–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –í—Å–µ 3 —Å–æ–±—ã—Ç–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
‚úÖ –î–∞–∂–µ 2 –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –Ω–µ —Å–ø–∞—Å–∞—é—Ç –∫—É–ø–æ–Ω
‚úÖ –ö—É–ø–æ–Ω —Å—Ç–∞—Ç—É—Å = "resolved", result = "loss"
‚úÖ –î–µ–Ω—å–≥–∏ –ù–ï –≤—ã–ø–ª–∞—á–µ–Ω—ã (–ø–æ—Ç–æ–º—É —á—Ç–æ –∫—É–ø–æ–Ω –ø—Ä–æ–∏–≥—Ä–∞–ª)
```

---

### –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–ï–¢–û–î–ê: updateBetStatus()

**–¢–µ—Å—Ç 1: –û—Ç–º–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å—Ç–∞–≤–∫–∏**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –°—Ç–∞–≤–∫–∞ #1: status='open', bet_amount=100.00
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = 5000.00

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
updateBetStatus(
    bet_id=1,
    new_status='cancelled',
    reason='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥—É–º–∞–ª'
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
{
  "success": true,
  "refund_amount": 100.00
}

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –°—Ç–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: status='cancelled'
‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 5000.00 ‚Üí 5100.00 (–≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ 100)
‚úÖ –í bet_transactions –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å "bet_cancelled"
‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç reason="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥—É–º–∞–ª"
```

**–¢–µ—Å—Ç 2: –û—Ç–º–µ–Ω–∞ —Å—Ç–∞–≤–∫–∏ –∫–æ—Ç–æ—Ä–∞—è –≤ –∫—É–ø–æ–Ω–µ**

```
–®–ê–ì 1: –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ
- –ö—É–ø–æ–Ω #1 —Å–æ–¥–µ—Ä–∂–∏—Ç 3 —Å—Ç–∞–≤–∫–∏ (IDs: 1, 2, 3)
- –°—Ç–∞–≤–∫–∞ #1 –≤ —ç—Ç–æ–º –∫—É–ø–æ–Ω–µ

–®–ê–ì 2: –î–µ–π—Å—Ç–≤–∏–µ
updateBetStatus(
    bet_id=1,
    new_status='cancelled',
    reason='–ú–∞—Ç—á –æ—Ç–º–µ–Ω—ë–Ω'
)

–®–ê–ì 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°—Ç–∞–≤–∫–∞ #1: cancelled
- –ö—É–ø–æ–Ω #1: —Ç–∞–∫–∂–µ cancelled (–ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç–∞–≤–∫–∞ –≤ –Ω—ë–º)

–®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ –°—Ç–∞–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
‚úÖ –ö—É–ø–æ–Ω #1 —Ç–∞–∫–∂–µ –æ—Ç–º–µ–Ω—ë–Ω (status='cancelled', result='void')
‚úÖ –í—Å—è —Å—É–º–º–∞ –∫—É–ø–æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚úÖ –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö: "bet_cancelled" –∏ "coupon_cancelled"
```

---

## üìä –≠–¢–ê–ü 5: –¢–ê–ë–õ–ò–¶–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í (1 —á–∞—Å)

### –ß–¢–û –¢–†–ï–¢–ò–ô –î–û–õ–ñ–ï–ù –°–û–ó–î–ê–¢–¨?

–¢–∞–±–ª–∏—Ü–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞.

# –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ú–û–î–£–õ–Ø –¢–†–ï–¢–¨–ï–ì–û (–°–¢–ê–í–ö–ò)

## –ú–ï–¢–û–î 1: placeBet()

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ            |
|------|---------------------------------------------|--------|-----------------------|
| 1    | –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ (100 USD @ 1.85) | ‚úÖ PASS | –ë–∞–ª–∞–Ω—Å: 5100 -> 5000  |
| 2    | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–±–∞–ª–∞–Ω—Å 50, —Å—Ç–∞–≤–∫–∞ 100)  | ‚úÖ PASS | –û—à–∏–±–∫–∞ 400 –≤–µ—Ä–Ω—É–ª–∞—Å—å  |
| 3    | –°–æ–±—ã—Ç–∏–µ –Ω–µ scheduled (—Å—Ç–∞—Ç—É—Å finished)      | ‚úÖ PASS | –û—à–∏–±–∫–∞ 400 –≤–µ—Ä–Ω—É–ª–∞—Å—å  |
| 4    | –°—Ç–∞–≤–∫–∞ –º–∏–Ω–∏–º—É–º (0.50 USD)                   | ‚úÖ PASS | –û—à–∏–±–∫–∞ - –º–∏–Ω–∏–º—É–º 1.00 |
| 5    | –°—Ç–∞–≤–∫–∞ –º–∞–∫—Å–∏–º—É–º (100000.00 USD)             | ‚úÖ PASS | –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–Ω—è—Ç–æ     |

**–ò—Ç–æ–≥–æ: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

---

## –ú–ï–¢–û–î 2: calculatePotentialWin()

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ             |
|------|--------------------------------------------|--------|------------------------|
| 1    | –û–¥–∏–Ω–æ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (100 @ 1.85)              | ‚úÖ PASS | Win = 185, Profit = 85 |
| 2    | –ö—É–ø–æ–Ω –∏–∑ 3 —Å—Ç–∞–≤–æ–∫ (150 @ 1.85*2\.10*3\.40) | ‚úÖ PASS | Win = 1987.65          |
| 3    | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (0.99)              | ‚úÖ PASS | –û—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å       |
| 4    | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (500)            | ‚úÖ PASS | –†–∞—Å—á—ë—Ç: 100\*500=50000 |

**–ò—Ç–æ–≥–æ: 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

---

## –ú–ï–¢–û–î 3: createCoupon()

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ                   |
|------|-----------------------------------------|--------|------------------------------|
| 1    | –°–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞ –∏–∑ 3 —Å—Ç–∞–≤–æ–∫             | ‚úÖ PASS | coupon_id = 1, code —Å–æ–∑–¥–∞–Ω   |
| 2    | –°—Ç–∞–≤–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –≤ –∫—É–ø–æ–Ω (–æ—à–∏–±–∫–∞)  | ‚úÖ PASS | –û—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å             |
| 3    | –°—Ç–∞–≤–∫–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ—à–∏–±–∫–∞) | ‚úÖ PASS | –û—à–∏–±–∫–∞ 403 (–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω) |
| 4    | –°–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞ –∏–∑ –æ–¥–Ω–æ–π —Å—Ç–∞–≤–∫–∏         | ‚úÖ PASS | –†–∞–∑—Ä–µ—à–µ–Ω–æ (—ç–∫—Å–ø—Ä–µ—Å—Å –∏–∑ 1)    |

**–ò—Ç–æ–≥–æ: 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

---

## –ú–ï–¢–û–î 4: resolveBet()

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ          |
|------|---------------------------------------------|--------|---------------------|
| 1    | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–≤—ã–∏–≥—Ä—ã—à 12, –ø—Ä–æ–∏–≥—Ä—ã—à 3) | ‚úÖ PASS | –í—ã–ø–ª–∞—á–µ–Ω–æ 2220 USD  |
| 2    | –°–æ–±—ã—Ç–∏–µ —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (–æ—à–∏–±–∫–∞)              | ‚úÖ PASS | –û—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å    |
| 3    | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å –∫—É–ø–æ–Ω–∞–º–∏ (–≤—Å–µ –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ)      | ‚úÖ PASS | –ö—É–ø–æ–Ω—ã –≤—ã–∏–≥—Ä–∞–Ω—ã     |
| 4    | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å –∫—É–ø–æ–Ω–∞–º–∏ (1 –ø—Ä–æ–∏–≥—Ä—ã—à)          | ‚úÖ PASS | –ö—É–ø–æ–Ω—ã –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω—ã |
| 5    | –ù–µ–≤–µ—Ä–Ω—ã–π winning_bet_type                   | ‚úÖ PASS | –û—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å    |

**–ò—Ç–æ–≥–æ: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

---

## –ú–ï–¢–û–î 5: updateBetStatus()

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                           | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ            |
|------|------------------------------------|--------|-----------------------|
| 1    | –û—Ç–º–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å—Ç–∞–≤–∫–∏             | ‚úÖ PASS | –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ 100 USD    |
| 2    | –û—Ç–º–µ–Ω–∞ —Å—Ç–∞–≤–∫–∏ –≤ –∫—É–ø–æ–Ω–µ             | ‚úÖ PASS | –ö—É–ø–æ–Ω —Ç–∞–∫–∂–µ –æ—Ç–º–µ–Ω—ë–Ω   |
| 3    | –û—Ç–º–µ–Ω–∞ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–π —Å—Ç–∞–≤–∫–∏ (–æ—à–∏–±–∫–∞) | ‚úÖ PASS | –û—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å      |
| 4    | –û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç–º–µ–Ω—ë–Ω–Ω–æ–π —Å—Ç–∞–≤–∫–∏ –∑–∞–Ω–æ–≤–æ  | ‚úÖ PASS | –î–µ–Ω—å–≥–∏ –≤—ã—á—Ç–µ–Ω—ã –∑–∞–Ω–æ–≤–æ |

**–ò—Ç–æ–≥–æ: 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

---

## –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

| –ú–µ—Ç–æ–¥                   | –¢–µ—Å—Ç–æ–≤ | –ü—Ä–æ–π–¥–µ–Ω–æ | –û—à–∏–±–æ–∫ | % –£—Å–ø–µ—Ö–∞ |
|-------------------------|--------|----------|--------|----------|
| placeBet()              | 5      | 5        | 0      | 100%     |
| calculatePotentialWin() | 4      | 4        | 0      | 100%     |
| createCoupon()          | 4      | 4        | 0      | 100%     |
| resolveBet()            | 5      | 5        | 0      | 100%     |
| updateBetStatus()       | 4      | 4        | 0      | 100%     |
| **–í–°–ï–ì–û**               | **22** | **22**   | **0**  | **100%** |

## –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

| –ú–µ—Ç–æ–¥                    | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è | –ú–∞–∫—Å. –≤—Ä–µ–º—è | –ú–∏–Ω. –≤—Ä–µ–º—è |
|--------------------------|---------------|-------------|------------|
| placeBet()               | 60ms          | 85ms        | 45ms       |
| calculatePotentialWin()  | 15ms          | 25ms        | 10ms       |
| createCoupon()           | 75ms          | 110ms       | 55ms       |
| resolveBet() (15 —Å—Ç–∞–≤–æ–∫) | 120ms         | 180ms       | 90ms       |
| updateBetStatus()        | 50ms          | 70ms        | 35ms       |

## –ù–ê–ì–†–£–ó–û–ß–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

| –°—Ü–µ–Ω–∞—Ä–∏–π                 | –ù–∞–≥—Ä—É–∑–∫–∞              | –†–µ–∑—É–ª—å—Ç–∞—Ç | –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ |
|--------------------------|-----------------------|-----------|--------------|
| 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ | 100 placeBet()        | ‚úÖ PASS    | 65ms avg     |
| 1000 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Å–æ–±—ã—Ç–∏–π  | 1000 resolveBet()     | ‚úÖ PASS    | 125ms avg    |
| 500 –æ—Ç–º–µ–Ω —Å—Ç–∞–≤–æ–∫         | 500 updateBetStatus() | ‚úÖ PASS    | 55ms avg     |

## –í–´–í–û–î–´

‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ 

‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ 

‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã \< 200ms) 

‚úÖ –ö–æ–¥ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω 

‚úÖ –î–µ–Ω—å–≥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è 

‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 

‚úÖ –ö—É–ø–æ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ 

‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö-–õ–ò–°–¢

### –¢–ê–ë–õ–ò–¶–´ –ë–î:

* [ ] users_balance (–±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

* [ ] bets (–≤—Å–µ —Å—Ç–∞–≤–∫–∏)

* [ ] coupons (–∫—É–ø–æ–Ω—ã/—ç–∫—Å–ø—Ä–µ—Å—Å—ã)

* [ ] coupon_bets (—Å–≤—è–∑—å –∫—É–ø–æ–Ω–æ–≤ –∏ —Å—Ç–∞–≤–æ–∫)

* [ ] bet_transactions (–∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

* [ ] bet_results (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π)

### –ú–ï–¢–û–î–´:

* [ ] placeBet() -- —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏

* [ ] calculatePotentialWin() -- —Ä–∞—Å—á—ë—Ç –≤—ã–∏–≥—Ä—ã—à–∞

* [ ] createCoupon() -- —Å–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞

* [ ] resolveBet() -- —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

* [ ] updateBetStatus() -- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–≤–∫–∏

### –î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–ù–ò–ï:

* [ ] Docstring –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

* [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

* [ ] –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞

* [ ] –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

* [ ] Database queries –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

### –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

* [ ] 3+ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

* [ ] –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (–≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç)

* [ ] –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (–æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è)

* [ ] Edge cases (–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏)

* [ ] –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê:

* [ ] –ù–µ—Ç SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

* [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

* [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î

* [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

* [ ] –í—Å–µ –¥–µ–Ω—å–≥–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### API ENDPOINTS:

* [ ] POST /api/bets/place (—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏)

* [ ] POST /api/bets/calculate (—Ä–∞—Å—á—ë—Ç –≤—ã–∏–≥—Ä—ã—à–∞)

* [ ] POST /api/bets/coupon/create (—Å–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞)

* [ ] POST /api/events/\{event_id}/resolve (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)

* [ ] PUT /api/bets/\{bet_id}/status (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞)

* [ ] GET /api/bets/\{user_id} (–∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## üí∞ –ü–û–õ–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–¢–û–ö–ê –î–ï–ù–ï–ì

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –°–¢–ê–í–ö–ò –ò –î–ï–ù–ï–ì                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–û–ü–û–õ–ù–Ø–ï–¢ –°–ß–Å–¢
   ‚Üì
   users_balance: 0 ‚Üí 5100.00
   bet_transactions: "deposit" (5100 USD)

2. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–ò–î–ò–¢ –°–û–ë–´–¢–ò–ï
   (–ü–µ—Ç—Ä–æ–≤ Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è)
   ‚Üì
   Frontend (–ê–ª–∏–Ω–∞) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã

3. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–´–ë–ò–†–ê–ï–¢ –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢ –ò –°–¢–ê–í–ò–¢
   ‚Üì
   placeBet(user_id, event_id, odds_id, 100.00)
   ‚Üì
   users_balance: 5100.00 ‚Üí 5000.00 (–≤—ã—á–ª–∏ 100)
   bets: new bet (status='open', potential_win=185)
   bet_transactions: "bet_placed" (-100)

4. –°–û–ë–´–¢–ò–ï –ò–î–Å–¢ (LIVE)
   (–ü–µ—Ç—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è)
   ‚Üì
   events: status='scheduled' ‚Üí 'live'

5. –°–û–ë–´–¢–ò–ï –ó–ê–í–ï–†–®–ê–ï–¢–°–Ø
   (–ü–µ—Ç—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
   ‚Üì
   events: status='live' ‚Üí 'finished'
   –ü–µ—Ç—Ä–æ–≤ —Å–æ–æ–±—â–∞–µ—Ç: Man Utd –≤—ã–∏–≥—Ä–∞–ª (2-1)

6. –¢–†–ï–¢–ò–ô –†–ê–ó–†–ï–®–ê–ï–¢ –°–¢–ê–í–ö–ò
   ‚Üì
   resolveBet(event_id=1, winning_bet_type="1")
   ‚Üì
   bets: status='open' ‚Üí 'resolved', result='win'
   actual_win: 185 USD
   
   –î–õ–Ø –í–´–ò–ì–†–´–®–ù–û–ô –°–¢–ê–í–ö–ò:
   users_balance: 5000.00 ‚Üí 5185.00 (–¥–æ–±–∞–≤–∏–ª–∏ 185)
   bet_transactions: "bet_won" (+185)
   
   –î–õ–Ø –ü–†–û–ò–ì–†–´–®–ù–û–ô –°–¢–ê–í–ö–ò:
   users_balance: –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π
   bet_transactions: "bet_lost" (0)

7. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–ò–î–ò–¢ –†–ï–ó–£–õ–¨–¢–ê–¢
   (Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
   ‚Üì
   "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 185 USD!"
   "–í–∞—à –±–∞–ª–∞–Ω—Å: 5185.00 USD"

8. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–´–í–û–î–ò–¢ –î–ï–ù–¨–ì–ò
   ‚Üì
   users_balance: 5185.00 ‚Üí 4185.00 (–≤—ã–≤–æ–¥ 1000)
   bet_transactions: "withdrawal" (-1000)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´:
‚úÖ –î–µ–Ω—å–≥–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –°–†–ê–ó–£ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏
‚úÖ –î–µ–Ω—å–≥–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä–∞–ª–∞
‚úÖ –í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–µ–Ω—å–≥–∞–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ bet_transactions
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª–Ω–∞—è –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è
‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å/–∫—É–¥–∞ –¥–µ–ª–∏—Å—å –¥–µ–Ω—å–≥–∏
```

---

## üìå –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

1. **6 —Ç–∞–±–ª–∏—Ü –ë–î** (users_balance, bets, coupons, coupon_bets, bet_transactions, bet_results)

2. **5 –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤:**

   -  placeBet() -> —Ä–∞–∑–º–µ—â–∞–µ—Ç —Å—Ç–∞–≤–∫—É, –≤—ã—á–∏—Ç–∞–µ—Ç –¥–µ–Ω—å–≥–∏ –∏–∑ –±–∞–ª–∞–Ω—Å–∞

   -  calculatePotentialWin() -> —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à

   -  createCoupon() -> —Å–æ–∑–¥–∞—ë—Ç –∫—É–ø–æ–Ω (—ç–∫—Å–ø—Ä–µ—Å—Å) –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–∞–≤–æ–∫

   -  resolveBet() -> —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∏/–ø—Ä–æ–∏–≥—Ä—ã—à–∏

   -  updateBetStatus() -> –æ—Ç–º–µ–Ω—è–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∞–≤–∫–∏

3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –≤–µ—Å—å –∫–æ–¥ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –º–∏–Ω–∏–º—É–º 22 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è

5. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–û–õ–ù–û–°–¢–¨–Æ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –°–¢–ê–í–û–ö‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å—Ç–∞–≤–∏—Ç—å          ‚îÇ
‚îÇ  ‚úÖ –†–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—ã–∏–≥—Ä—ã—à–∏/–ø—Ä–æ–∏–≥—Ä—ã—à–∏    ‚îÇ
‚îÇ  ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç —ç–∫—Å–ø—Ä–µ—Å—Å—ã (–∫—É–ø–æ–Ω—ã)         ‚îÇ
‚îÇ  ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è  ‚îÇ
‚îÇ  ‚úÖ –î–µ–Ω—å–≥–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è         ‚îÇ
‚îÇ  ‚úÖ –í—Å—ë –≤ –ë–î, –≤—Å—ë –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è        ‚îÇ
‚îÇ  ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production!                ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```