# =============================================================================
# Alembic Migration Configuration (YAML)
# =============================================================================
# Конфигурация для миграций базы данных через Alembic
# =============================================================================

# Основные настройки
alembic:
  # Путь к скриптам миграций
  script_location: alembic
  
  # Версия базы данных
  version_locations: alembic/versions
  
  # Шаблон для новых миграций
  file_template: "%%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d%%(second).2d_%%(rev)s_%%(slug)s"
  
  # Логирование
  logging:
    level: INFO
    format: "%(levelname)-5.5s [%(name)s] %(message)s"
    date_format: "%Y-%m-%d %H:%M:%S"

# Настройки базы данных
database:
  # URL подключения (будет переопределён из .env)
  url: ${DATABASE_URL}
  
  # Драйвер
  driver: postgresql
  
  # Пул соединений
  pool:
    size: 5
    max_overflow: 10
    pool_timeout: 30
    pool_recycle: 3600

# Настройки миграций
migrations:
  # Автоматическая генерация миграций
  auto_generate: true
  
  # Сравнение типов
  compare_type: true
  compare_server_default: true
  
  # Включить проверку именованных ограничений
  include_object:
    - table
    - column
    - index
    - constraint
    - foreign_key

# Настройки окружений
environments:
  development:
    database_url: ${DATABASE_URL:-postgresql://postgres:postgres@localhost:5432/looseline}
    auto_migrate: true
    
  production:
    database_url: ${DATABASE_URL}
    auto_migrate: false
    require_confirmation: true

# Настройки для разных окружений
staging:
  database_url: ${DATABASE_URL}
  auto_migrate: false

# История миграций
revision_history:
  # Хранить историю в БД
  store_in_database: true
  
  # Таблица для истории
  version_table: alembic_version

# Настройки отката (rollback)
rollback:
  # Количество версий для отката
  steps: 1
  
  # Подтверждение перед откатом
  require_confirmation: true

# Настройки для генерации миграций
generate:
  # Автоматически определять изменения
  autogenerate: true
  
  # Включать комментарии в миграции
  include_comments: true
  
  # Формат даты в именах файлов
  date_format: "%Y%m%d_%H%M%S"

